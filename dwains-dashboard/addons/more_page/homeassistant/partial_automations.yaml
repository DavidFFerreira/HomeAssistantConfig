---
type: custom:stack-in-card
cards:
  - type: entities
    title: Automations - Last Triggered
    style: |
      ha-card {
        # padding-bottom: 10px;
        background-color: var(--dwains-theme-primary)
      }
      .card-header {
        padding: 5px 16px;
        font-size: 18px;
        font-weight: 700 !important;
      }
      .card-content div {
          margin: 0 !important;
      }
      #states {
        padding-top: 0px !important;
        padding-bottom: 0px !important;
      }
      .secondary {
        color: darkgray !important;
        margin-left: 2px !important;
      }
    entities:
      - entity: sensor.count_automations
  - type: markdown
    content: |
      |D|H|M||Name|
      |----:|----:|----:|:--:|:----|
      {% for state in states.automation
        |selectattr('attributes.last_triggered')
        |sort(attribute='attributes.last_triggered', reverse=true) -%}
        {%- set t = now() - state.attributes.last_triggered -%}
        {%- set days = t.days if t.days > 0 else 0 -%}
        {%- set hrs = t.seconds//3600 %}
        {%- set hrs = hrs if hrs > 0 else 0 -%}
        |{{days}}|{{hrs}}|{{(t.seconds//60)%60}}||{{state.name}}|
      {% endfor %}
    card_mod:
      style:
        ha-markdown:
          $:
            ha-markdown-element: |
              table { width: 100%; border-spacing: 0; padding: 8px; border-radius: var(--ha-card-border-radius);}
              th { background-color: var(--dwains-theme-header-background); color: var(--dwains-theme-header-text); padding: 4px;}
              th:first-child { border-top-left-radius: var(--ha-card-border-radius); }
              th:last-child { border-top-right-radius: var(--ha-card-border-radius); }
              td { padding: 4px; }
              td em { font-size: 10px; }
              tr:nth-child(even) { background-color: var(--table-row-background-color); }
