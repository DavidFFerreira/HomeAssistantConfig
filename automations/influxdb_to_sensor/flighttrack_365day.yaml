---
id: "influx2entity_flighttrack365day"
alias: "InfluxDB to Entity: 365 Day Flight Tracker"
description: "InfluxDB to Entity: 365 Day Flight Tracker"
trigger:
  - platform: homeassistant
    event: start
  - platform: time_pattern
    hours: "/1"
condition: []
action:
  - service: pyscript.influxdb_query_to_entity
    data:
      database: homeassistant
      query: >-
        SELECT max("value") AS "value"
        FROM "homeassistant"."autogen"."Flights"
        WHERE time >= now() - 365d AND "entity_id"='flighttracker_flights_24hr'
        GROUP BY time(1d) FILL(linear) tz('Australia/Sydney')
      key_field_name: time
      value_field_name: value
      entity_id: sensor.archive_flighttracker_flights_365day
      unit_of_measurement: Flights
      friendly_name: Flight Tracker - Flights - 365 Day
      icon: "mdi:airplane-takeoff"
  - service: pyscript.influxdb_query_to_entity
    data:
      database: homeassistant
      query: >-
        SELECT max("value") AS "value"
        FROM "homeassistant"."autogen"."km"
        WHERE time >= now() - 365d AND "entity_id"='flighttracker_maxdistance_km'
        GROUP BY time(1d) FILL(linear) tz('Australia/Sydney')
      key_field_name: time
      value_field_name: value
      entity_id: sensor.archive_flighttracker_maxdistance_365day
      unit_of_measurement: km
      friendly_name: Flight Tracker - Max Distance - 365 Day
      icon: "mdi:airplane-marker"
  - service: pyscript.influxdb_query_to_entity
    data:
      database: homeassistant
      query: >-
        SELECT mean("value") AS "value"
        FROM "homeassistant"."autogen"."km"
        WHERE time >= now() - 365d AND "entity_id"='flighttracker_maxdistance_km'
        GROUP BY time(1d) FILL(linear) tz('Australia/Sydney')
      key_field_name: time
      value_field_name: value
      entity_id: sensor.archive_flighttracker_avgdistance_365day
      unit_of_measurement: km
      friendly_name: Flight Tracker - Avg Distance - 365 Day
      icon: "mdi:airplane-marker"
mode: single
